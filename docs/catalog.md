# Opendbt Catalog

[See it in action](https://memiiso.github.io/opendbt/opendbtdocs/)

## Generating the Enhanced Catalog

To generate the enhanced catalog UI with column-level lineage, use the opendbt CLI:

```bash
python -m opendbt docs generate
```

This command will:
- Generate standard dbt catalog files (`catalog.json`, `manifest.json`)
- Generate `catalogl.json` with column-level lineage information
- Deploy the enhanced catalog UI to your target directory

**Important:** Using the standard `dbt docs generate` command will generate only the basic dbt documentation without the enhanced UI and `catalogl.json` file.

## Customizing the Catalog UI

You can override the default enhanced UI with your own custom `index.html` by placing it in your dbt project's `docs` directory:

1. Create a `docs` folder in your dbt project root (if it doesn't exist)
2. Add your custom `index.html` to this folder
3. Ensure `dbt_project.yml` includes the docs path:
   ```yaml
   docs-paths: ["docs"]
   ```
4. Run `python -m opendbt docs generate`

The priority order is:
1. User-provided `index.html` from `docs-paths` (highest priority)
2. Opendbt's enhanced catalog UI (automatic fallback)
3. Standard dbt-generated UI (only if using `dbt docs generate`)

## Multi-project setup

### Core Functionality
   - Added environment variable-based plugin mode switching (single/multi)
   - Plugin now supports both single-project and multi-project modes
   - Multi-project configuration via Airflow Variables
   - Case-insensitive variable lookup for compatibility with `AIRFLOW_VAR_*` env vars

### Configuration

The plugin auto-detects based on configuration:
- If Airflow Variable `opendbt_docs_projects` is set, it will use that (overrides hardcoded paths)
- Otherwise, it will use the path(s) provided in plugin initialization code

#### Option 1: Airflow Variable (recommended for dynamic configuration)

Setup Admin â†’ Variables:
   ```
   opendbt_docs_projects:
      [
         "/opt/dbtcore/target",
         "/opt/dbtfinance/target"
      ]
   ```

Or for a single project:
   ```
   opendbt_docs_projects: "/opt/dbtcore/target"
   ```

#### Option 2: Hardcoded in plugin file

   ```python
   # Single project
   airflow_dbtdocs_page = plugin.init_plugins_dbtdocs_page(
       Path('/opt/dbtcore/target')
   )

   # Or multiple projects
   airflow_dbtdocs_page = plugin.init_plugins_dbtdocs_page([
       Path('/opt/project1/target'),
       Path('/opt/project2/target')
   ])
   ```

## Catalog Files Summary

- [catalog.json](catalog.json): Generated by dbt
- [catalogl.json](catalogl.json): Generated by opendbt contains extended catalog information with column level lineage
- [manifest.json](manifest.json): Generated by dbt
- [run_info.json](run_info.json): Generated by opendbt, contains latest run information per object/model

## Key Features

### Up to date Run information

![docs-run-info.png](assets/docs-run-info.png)

### Run information with error messages

![docs-run-info-error.png](assets/docs-run-info-error.png)

### Model dependencies including tests

![docs-dependencies.png](assets/docs-dependencies.png)

### Column level dependency lineage, transformation

![docs-columns-transformation.png](assets/docs-columns-transformation.png)

### Dependency lineage

![docs-lineage.png](assets/docs-lineage.png)

### Multi-project support

<img src="assets/docs-ui-multiproject.png" height="75">
<img src="assets/docs-ui-multiproject-dropdown.png" height="75">
